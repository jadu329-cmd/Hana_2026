<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ë„êµ¬</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¦ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ë„êµ¬</h1>
        
        <div class="info">
            <strong>ì‚¬ìš© ë°©ë²•:</strong><br>
            1. ì´ì „ì— ì‚¬ìš©í•˜ë˜ ë¸Œë¼ìš°ì €ì—ì„œ ì´ í˜ì´ì§€ë¥¼ ì—½ë‹ˆë‹¤<br>
            2. "localStorage ë°ì´í„° í™•ì¸" ë²„íŠ¼ í´ë¦­<br>
            3. ë°ì´í„°ê°€ ìˆìœ¼ë©´ "Firebaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜" ë²„íŠ¼ í´ë¦­<br>
            4. ì™„ë£Œ!
        </div>

        <button onclick="checkLocalStorage()">localStorage ë°ì´í„° í™•ì¸</button>
        <button onclick="migrateToFirebase()">Firebaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜</button>
        <button onclick="clearLocalStorage()">localStorage ë¹„ìš°ê¸° (ë§ˆì´ê·¸ë ˆì´ì…˜ í›„)</button>

        <div id="result"></div>
    </div>

    <script>
        // Firebase ì„¤ì • (Hana_council.htmlê³¼ ë™ì¼)
        const firebaseConfig = {
            apiKey: "AIzaSyALDK7sAJx32ZJt75osEAPIGXmmmH_MI2c",
            authDomain: "team-hana.firebaseapp.com",
            projectId: "team-hana",
            storageBucket: "team-hana.firebasestorage.app",
            messagingSenderId: "1088617617940",
            appId: "1:1088617617940:web:29a69f3b78b89e9ad4a501"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const collections = [
            'youthCalendarEvents',
            'youthMeetingLogs',
            'visitData',
            'fellowshipData',
            'mealData',
            'youthParticipantsList',
            'navOrder'
        ];

        function showResult(message, isSuccess = true) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result ' + (isSuccess ? 'success' : 'error');
            resultDiv.innerHTML = message;
        }

        function checkLocalStorage() {
            let found = [];
            let notFound = [];

            collections.forEach(collection => {
                const data = localStorage.getItem(collection);
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        found.push(`${collection}: ${JSON.stringify(parsed).length} bytes`);
                    } catch (e) {
                        found.push(`${collection}: (íŒŒì‹± ì˜¤ë¥˜)`);
                    }
                } else {
                    notFound.push(collection);
                }
            });

            let message = '<h3>localStorage ë°ì´í„° í™•ì¸ ê²°ê³¼</h3>';
            if (found.length > 0) {
                message += '<strong>ë°œê²¬ëœ ë°ì´í„°:</strong><ul>';
                found.forEach(item => {
                    message += `<li>${item}</li>`;
                });
                message += '</ul>';
            } else {
                message += '<p>localStorageì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }

            if (notFound.length > 0 && found.length > 0) {
                message += '<strong>ë°ì´í„° ì—†ìŒ:</strong><ul>';
                notFound.forEach(item => {
                    message += `<li>${item}</li>`;
                });
                message += '</ul>';
            }

            showResult(message, found.length > 0);
        }

        async function migrateToFirebase() {
            showResult('ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘...', true);
            
            let migrated = 0;
            let errors = [];

            for (const collection of collections) {
                const data = localStorage.getItem(collection);
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        await db.collection('appData').doc(collection).set({
                            data: parsed,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                            migrated: true
                        });
                        migrated++;
                    } catch (error) {
                        errors.push(`${collection}: ${error.message}`);
                    }
                }
            }

            let message = '<h3>ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ</h3>';
            message += `<p><strong>${migrated}ê°œ</strong> ì»¬ë ‰ì…˜ì„ Firebaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í–ˆìŠµë‹ˆë‹¤.</p>`;
            
            if (errors.length > 0) {
                message += '<strong>ì˜¤ë¥˜:</strong><ul>';
                errors.forEach(error => {
                    message += `<li>${error}</li>`;
                });
                message += '</ul>';
            } else {
                message += '<p>âœ… ëª¨ë“  ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ë˜ì—ˆìŠµë‹ˆë‹¤!</p>';
                message += '<p>ì´ì œ https://team-hana.web.app ì—ì„œ ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>';
            }

            showResult(message, errors.length === 0);
        }

        function clearLocalStorage() {
            if (confirm('ì •ë§ localStorageì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (Firebaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•œ í›„ì—ë§Œ ì‹¤í–‰í•˜ì„¸ìš”)')) {
                collections.forEach(collection => {
                    localStorage.removeItem(collection);
                });
                showResult('localStorageê°€ ë¹„ì›Œì¡ŒìŠµë‹ˆë‹¤.', true);
            }
        }
    </script>
</body>
</html>

